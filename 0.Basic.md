<!--
 * @Date: 2024-11-10
 * @LastEditors: GoKo-Son626
 * @LastEditTime: 2024-11-20
 * @FilePath: /1-STM32MP157/0.Basic.md
 * @Description: 
-->
# Basic

1. 驱动文件加载
```c
cp xxx.ko /rootfs/lib/moudles/5.4.31/
cd /rootfs/lib/moudles/5.4.31/
depmod
modprobe xxx.ko
lsmod
rmmod xxx.ko
lsmod
```
2. APP执行
```c
mknod /dev/xxx c major x //添加设备节点
./xxxApp /dev/xxx
```
3. 查看帮助文档
man n read      //n:"不同类型"

4. 编译linux系统
chmod 777 stm32mp157d_atk.sh
./stm32mp157d_atk.sh
`uImage`: linux-5.4.31/arch/arm/boot/uImage
`stm32mp157d-atk.dtb`: linux-5.4.31/arch/arm/boot/dts/stm32mp157d-atk.dtb 

5. boot启动
- STM32MP> printenv bootcmd
bootcmd=tftp c2000000 uImage; tftp c4000000 stm32mp157d-atk.dtb;bootm c2000000 - c4000000
- STM32MP> printenv bootargs
bootargs=root=/dev/nfs nfsroot=192.168.1.106:/home/goko/nfs/rootfs,tcp,v3,rsize=8192,wsize=8192 ip=192.168.1.104::192.168.1.106:255.255.255.0:stm32mp:eth0:off nfsrootdebug

6. buildroot
make stm32mp1_atk_defconfig
make -j8

`stm32mp1_atk_defconfig`: /buildroot-2020.02.6/configs/stm32mp1_atk_defconfig

**UNright**
Maybe you across this error:
1. 
```c
usr/bin/ld: scripts/dtc/dtc-parser.tab.o:(.bss+0x10): multiple definition of 'yylloc'; scripts/dtc/dtc-lexer.lex.o:(.bss+0x0): first defined here
collect2: error: ld returned 1 exit status
```
> edit the file ./linux-rtk/scripts/dtc/dtc-lexer-lex.c, Find the line 'YYLTYPE yylloc' and change it to 'extern YYLTYPE yylloc'

2.
```c
You have PERL_MM_OPT defined because Perl local::lib
is installed on your system. Please unset this variable
before starting Buildroot, otherwise the compilation of
Perl related packages will fail
make[1]: *** [support/dependencies/dependencies.mk:27：dependencies] 错误 1
make: *** [Makefile:84：_all] 错误 2
```
> unset PERL_MM_OPT

3. 
In file included from /usr/include/signal.h:328,
                 from ./signal.h:52,
                 from c-stack.c:49:
c-stack.c:55:26: error: missing binary operator before token "("
   55 | #elif HAVE_LIBSIGSEGV && SIGSTKSZ < 16384
      |                          ^~~~~~~~
  CC       closein.o
  CC       closeout.o
make[5]: *** [Makefile:1915: c-stack.o] Error 1
make[5]: *** Waiting for unfinished jobs....
make[4]: *** [Makefile:1674: all] Error 2
make[3]: *** [Makefile:1572: all-recursive] Error 1
make[2]: *** [Makefile:1528：all] 错误 2
make[1]: *** [package/pkg-generic.mk:269：/home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/build/host-m4-1.4.18/.stamp_built] 错误 2
make: *** [Makefile:84：_all] 错误 2

> sudo apt-get install >libsigsegv-dev
export CFLAGS="-I/usr/include"
export LDFLAGS="-L/usr/lib"
make

4. Buildroot 无法找到 m4-1.4.19.tar.xz 的哈希值，从而导致构建失败。为了解决这个问题，您需要手动添加哈希值，以便 Buildroot 能够验证下载的文件的完整性。
```c
See any operating system documentation about shared libraries for
more information, such as the ld(1) and ld.so(8) manual pages.
----------------------------------------------------------------------
 /usr/bin/mkdir -p '/home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/host/bin'
  /bin/bash ./libtool   --mode=install /usr/bin/install -c chacl getfacl setfacl '/home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/host/bin'
libtool: install: /usr/bin/install -c chacl /home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/host/bin/chacl
libtool: install: /usr/bin/install -c getfacl /home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/host/bin/getfacl
libtool: install: /usr/bin/install -c setfacl /home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/host/bin/setfacl
ERROR: No hash found for m4-1.4.19.tar.xz
make[1]: *** [package/pkg-generic.mk:171：/home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/build/host-m4-1.4.19/.stamp_downloaded] 错误 1
make: *** [Makefile:84：_all] 错误 2
```
> sha256sum /home/goko/linux/Need_of_image/4-rootfs_atk/buildroot-2020.02.6/output/build/m4-1.4.19.tar.xz
打开 m4.mk 文件并找到类似如下的行：

M4_SOURCE = m4-$(M4_VERSION).tar.xz
如果在文件中找到了 M4_HASH 这一项，手动将 M4_HASH 设置为刚才计算的哈希值。例如：

M4_HASH = <calculated-hash-value>
如果文件中没有 M4_HASH，请手动添加这一行，
















